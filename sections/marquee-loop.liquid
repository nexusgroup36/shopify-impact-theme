{% comment %}
  Scrolling USP Marquee — infinite, seamless
  Drop into: sections/scrolling-usp-marquee.liquid
{% endcomment %}

<section id="marquee-{{ section.id }}" class="wl-marquee"
  style="
    --wl-gap: {{ section.settings.gap | default: 48 }}px;
    --wl-speed: {{ section.settings.speed | default: 24 }}s;
    --wl-pad-y: {{ section.settings.pad_y | default: 24 }}px;
    --wl-pad-x: {{ section.settings.pad_x | default: 0 }}px;
    --wl-font-size: {{ section.settings.font_size | default: 20 }}px;
    --wl-icon-size: {{ section.settings.icon_size | default: 24 }}px;
    --wl-text-weight: {{ section.settings.text_weight | default: 400 }};
    --wl-gradient-from: {{ section.settings.grad_from | default: '#ee6084' }};
    --wl-gradient-to: {{ section.settings.grad_to | default: '#ffbb82' }};
    --wl-solid-color: {{ section.settings.solid_color | default: '#1a1a1a' }};
    --wl-max-width: {% if section.settings.full_width %}100%{% else %}{{ section.settings.max_width | default: 1200 }}px{% endif %};
  "
>
  <div class="wl-marquee__viewport">
    <div class="wl-marquee__track">
      {%- assign items = section.blocks -%}

      {%- comment -%}
        We render two identical rows (A + A) inside the same track.
        The track animates from 0 to -50%, so the loop is seamless.
      {%- endcomment -%}

      <div class="wl-marquee__row wl-marquee__row--a">
        {%- for block in items -%}
          <div class="wl-marquee__item" {{ block.shopify_attributes }}>
            <span class="wl-marquee__icon">
              {%- if block.settings.svg_icon != blank -%}
                {{ block.settings.svg_icon }}
              {%- elsif block.settings.image != blank -%}
                <img 
                  src="{{ block.settings.image | image_url: width: 96 }}" 
                  alt="" 
                  width="{{ block.settings.icon_width | default: 32 }}" 
                  height="{{ block.settings.icon_width | default: 32 }}" 
                  loading="lazy">
              {%- endif -%}
            </span>
            <span class="wl-marquee__text{% if section.settings.use_gradient %} wl-marquee__text--gradient{% endif %}">
              {{ block.settings.text | escape }}
            </span>
          </div>
        {%- endfor -%}
      </div>

      <div class="wl-marquee__row wl-marquee__row--b">
        {%- for block in items -%}
          <div class="wl-marquee__item">
            <span class="wl-marquee__icon">
              {%- if block.settings.svg_icon != blank -%}
                {{ block.settings.svg_icon }}
              {%- elsif block.settings.image != blank -%}
                <img 
                  src="{{ block.settings.image | image_url: width: 96 }}" 
                  alt="" 
                  width="{{ block.settings.icon_width | default: 32 }}" 
                  height="{{ block.settings.icon_width | default: 32 }}" 
                  loading="lazy">
              {%- endif -%}
            </span>
            <span class="wl-marquee__text{% if section.settings.use_gradient %} wl-marquee__text--gradient{% endif %}">
              {{ block.settings.text | escape }}
            </span>
          </div>
        {%- endfor -%}
      </div>
    </div>

    {%- if section.settings.fade_edges -%}
    <div class="wl-marquee__overlay" aria-hidden="true"></div>
    {%- endif -%}
  </div>
</section>

<style>
  /* Scope styles to this section id */
  #marquee-{{ section.id }}.wl-marquee {
    padding-block: var(--wl-pad-y);
    padding-inline: var(--wl-pad-x);
    font-size: var(--wl-font-size);
    font-weight: var(--wl-text-weight);
  }

  #marquee-{{ section.id }} .wl-marquee__viewport {
    max-width: var(--wl-max-width);
    margin-inline: auto;
    position: relative;
    overflow: hidden;
  }

  /* The whole track scrolls for a seamless loop */
  #marquee-{{ section.id }} .wl-marquee__track {
    display: flex;
    gap: var(--wl-gap);
    width: max-content; /* content controls width */
    will-change: transform;
    animation: wl-scroll-{{ section.id }} var(--wl-speed) linear infinite;
  }

  /* Two identical rows next to each other */
  #marquee-{{ section.id }} .wl-marquee__row {
    display: inline-flex;
    gap: var(--wl-gap);
    align-items: center;
    white-space: nowrap;
  }

  /* Individual item */
  #marquee-{{ section.id }} .wl-marquee__item {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    flex-shrink: 0;
  }

  /* Icon: supports inline SVG or IMG */
  #marquee-{{ section.id }} .wl-marquee__icon svg {
    width: var(--wl-icon-size);
    height: var(--wl-icon-size);
    display: block;
  }

  #marquee-{{ section.id }} .wl-marquee__icon img {
    width: var(--wl-icon-size);
    height: var(--wl-icon-size);
    object-fit: contain;
    display: block;
  }

  /* Text color modes */
  #marquee-{{ section.id }} .wl-marquee__text {
    color: var(--wl-solid-color);
    line-height: 1;
  }

  #marquee-{{ section.id }} .wl-marquee__text--gradient {
    background: linear-gradient(90deg, var(--wl-gradient-from), var(--wl-gradient-to));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    color: transparent;
  }

  /* Optional fade edges */
  #marquee-{{ section.id }} .wl-marquee__overlay {
    pointer-events: none;
    position: absolute;
    inset: 0;
  }
  #marquee-{{ section.id }} .wl-marquee__overlay::before,
  #marquee-{{ section.id }} .wl-marquee__overlay::after {
    content: "";
    position: absolute;
    top: 0; bottom: 0;
    width: 32px;
  }
  #marquee-{{ section.id }} .wl-marquee__overlay::before {
    left: 0;
    background: linear-gradient(90deg, rgb(255 255 255 / 1), rgb(255 255 255 / 0));
  }
  #marquee-{{ section.id }} .wl-marquee__overlay::after {
    right: 0;
    background: linear-gradient(270deg, rgb(255 255 255 / 1), rgb(255 255 255 / 0));
  }

  /* Animation: move the track by half its width (row A width) */
  @keyframes wl-scroll-{{ section.id }} {
    from { transform: translateX(0); }
    to   { transform: translateX(-50%); }
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    #marquee-{{ section.id }} .wl-marquee__track {
      animation: none;
      transform: none;
    }
  }

  /* Mobile tweaks */
  @media (max-width: 767px) {
    #marquee-{{ section.id }}.wl-marquee {
      --wl-font-size: {{ section.settings.font_size_mobile | default: 18 }}px;
      --wl-icon-size: {{ section.settings.icon_size_mobile | default: 20 }}px;
      --wl-gap: {{ section.settings.gap_mobile | default: 32 }}px;
      --wl-pad-y: {{ section.settings.pad_y_mobile | default: 16 }}px;
      --wl-pad-x: {{ section.settings.pad_x_mobile | default: 16 }}px;
    }
  }
  /* --- FIX: stop cropping descenders (g/j/p/y) --- */
#marquee-{{ section.id }} .wl-marquee__viewport{
  overflow-x: hidden !important;   /* keep horizontal crop */
  overflow-y: visible !important;  /* allow vertical overflow */
}

/* --- FIX: give line box a touch more headroom --- */
#marquee-{{ section.id }} .wl-marquee__text{
  display: inline-block;           /* avoids inline line-box clipping */
  line-height: 1.2 !important;     /* was 1; too tight for gradient text */
  padding-bottom: 0.15em;          /* tiny nudge cures WebKit baseline cut */
}

/* (Nice-to-have) keep icons and text aligned and avoid GPU rounding cuts */
#marquee-{{ section.id }} .wl-marquee__item{
  align-items: center;
  padding-block: 0.1em;            /* little breathing room top/bottom */
}

#marquee-{{ section.id }} .wl-marquee__track{
  transform: translate3d(0,0,0);   /* prevent sub-pixel baseline trimming */
  will-change: transform;
}
</style>

{% schema %}
{
  "name": "Scrolling USP Marquee",
  "class": "section",
  "settings": [
    { "type": "checkbox", "id": "full_width", "label": "Full width container", "default": true },
    { "type": "range", "id": "max_width", "label": "Max width (px, when not full width)", "min": 600, "max": 1800, "step": 20, "default": 1200 },

    { "type": "range", "id": "gap", "label": "Gap between items (px)", "min": 8, "max": 120, "step": 2, "default": 48 },
    { "type": "range", "id": "gap_mobile", "label": "Gap on mobile (px)", "min": 8, "max": 120, "step": 2, "default": 32 },

    { "type": "range", "id": "speed", "label": "Scroll duration (seconds, smaller = faster)", "min": 6, "max": 60, "step": 1, "default": 24 },

    { "type": "range", "id": "font_size", "label": "Text size (px)", "min": 12, "max": 48, "step": 1, "default": 20 },
    { "type": "range", "id": "font_size_mobile", "label": "Text size on mobile (px)", "min": 12, "max": 40, "step": 1, "default": 18 },

    { "type": "range", "id": "icon_size", "label": "Icon size (px)", "min": 12, "max": 64, "step": 1, "default": 24 },
    { "type": "range", "id": "icon_size_mobile", "label": "Icon size on mobile (px)", "min": 12, "max": 64, "step": 1, "default": 20 },

    { "type": "range", "id": "text_weight", "label": "Text weight", "min": 300, "max": 800, "step": 50, "default": 400 },

    { "type": "checkbox", "id": "use_gradient", "label": "Use gradient text", "default": true },
    { "type": "color", "id": "grad_from", "label": "Gradient from", "default": "#ee6084" },
    { "type": "color", "id": "grad_to", "label": "Gradient to", "default": "#ffbb82" },
    { "type": "color", "id": "solid_color", "label": "Solid text color (when gradient off)", "default": "#1a1a1a" },

    { "type": "checkbox", "id": "fade_edges", "label": "Fade edges", "default": true },

    { "type": "range", "id": "pad_y", "label": "Vertical padding (px)", "min": 0, "max": 80, "step": 2, "default": 24 },
    { "type": "range", "id": "pad_x", "label": "Side padding (px)", "min": 0, "max": 80, "step": 2, "default": 0 },

    { "type": "range", "id": "pad_y_mobile", "label": "Vertical padding mobile (px)", "min": 0, "max": 80, "step": 2, "default": 16 },
    { "type": "range", "id": "pad_x_mobile", "label": "Side padding mobile (px)", "min": 0, "max": 80, "step": 2, "default": 16 }
  ],
  "blocks": [
    {
      "type": "usp",
      "name": "USP item",
      "settings": [
        { "type": "text", "id": "text", "label": "Text", "default": "2 Year Warranty" },
        { "type": "image_picker", "id": "image", "label": "Icon image (optional)" },
        { "type": "textarea", "id": "svg_icon", "label": "Inline SVG (optional)", "info": "Paste raw <svg>…</svg>. If provided, it overrides the image." },
        { "type": "range", "id": "icon_width", "label": "Icon intrinsic size for width/height attributes", "min": 16, "max": 96, "step": 1, "default": 32 }
      ]
    }
  ],
  "max_blocks": 24,
  "presets": [
    {
      "name": "Scrolling USP Marquee",
      "category": "Text",
      "blocks": [
        { "type": "usp", "settings": { "text": "2 Year Warranty" } },
        { "type": "usp", "settings": { "text": "Free shipping from €50" } },
        { "type": "usp", "settings": { "text": "60-Day Money-Back Guarantee" } },
        { "type": "usp", "settings": { "text": "Certified Protection" } }
      ]
    }
  ]
}
{% endschema %}
